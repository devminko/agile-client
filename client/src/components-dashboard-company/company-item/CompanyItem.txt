import React, { useEffect } from 'react';
import { useHistory } from 'react-router-dom';
import { connect } from 'react-redux';
import PropTypes from 'prop-types';
import uuid from 'uuid/dist/v4';

import { getAllCompanies, getCompany, deleteCompany } from '../../redux/company/company.actions';

import Button from '../../components/button/Button';

import style from './company-item.module.scss';

// *************************** COMPANY ITEM PAGE COMPONENT *************************** //
const CompanyItem = ({ client, companies, currentCompany, loading, getAllCompanies, getCompany, deleteCompany }) => {
  // 'client' passed down as object via 'ClientPage.js' to allow Company filtering
  useEffect(() => {
    getAllCompanies();
  }, []);
  
  console.log(`Current Company: ${currentCompany}`);

  const history = useHistory();
  const navigateToCompany = (companyId) => {
    history.push(`/dashboard/clients/company/${companyId}`);
  };
  const navigateToCreateCompany = (clientId) => {
    history.push(`/dashboard/clients/company-create/${clientId}`);
  };

  const companyContainer = (
    companies.map(company => (
      company.associated_client === client.id
        &&
          <div key={company.id} className={style.companyContainer}>
            <h4>{company.company_name}</h4>
            <p>{company.website}</p>
            <p>{company.address}</p>
            <p>{company.company_number}</p>
            <p>{company.company_notes}</p>
            <div className={style.buttonContainer}>
              <Button onClick={() => navigateToCompany(company.id)} addButton>View Company</Button>
              <Button onClick={() => deleteCompany(company.id)} deleteButton>Delete Company</Button>
            </div>
          </div>
    ))
  );

  return (
    <div className={style.companyItem}>
      {
        loading ? <p>Loading...</p> : companyContainer
      }
    </div>
  )
};

// PROP TYPES
CompanyItem.propTypes = {
  client: PropTypes.object.isRequired,
  companies: PropTypes.array,
  currentCompany: PropTypes.object,
  loading: PropTypes.bool.isRequired,
  getAllCompanies: PropTypes.func.isRequired,
  getCompany: PropTypes.func.isRequired,
  deleteCompany: PropTypes.func.isRequired,
};

// REDUX
const mapStateToProps = (state) => ({
  companies: state.company.companies,
  currentCompany: state.company.currentCompany,
  loading: state.company.loading,
});

const mapDispatchToProps = (dispatch) => ({
  getAllCompanies: () => dispatch(getAllCompanies()),
  getCompany: (companyId) => dispatch(getCompany(companyId)),
  deleteCompany: (companyId) => dispatch(deleteCompany(companyId)),
});

export default connect(mapStateToProps, mapDispatchToProps)(CompanyItem);